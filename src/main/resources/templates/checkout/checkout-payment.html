<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Pagamento</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/client/checkout-payment.css}">
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="container mt-5 mb-5">
    <div class="card shadow p-4 rounded-4">
        <h2 class="mb-4 text-center text-primary fw-bold">Escolha o Método de Pagamento</h2>

        <form id="paymentForm" th:action="@{/checkout/validate}" method="post">

            <div class="mb-3">
                <label for="freight" class="form-label">Escolha o tipo de frete:</label>
                <select name="freteTipo" id="freight" class="form-select" required>
                    <option th:each="freight : ${freteTipos}"
                            th:value="${freight.enumName}"
                            th:text="${freight.nome + ' - R$ ' + freight.valor}">
                    </option>
                </select>
            </div>


            <div class="mb-3">
                <label class="form-label">Forma de Pagamento:</label>
                <div>
                    <input class="form-check-input" type="radio" name="paymentMethod" value="boleto" id="boletoOption" required>
                    <label class="form-check-label" for="boletoOption">Boleto</label>
                </div>
                <div>
                    <input class="form-check-input" type="radio" name="paymentMethod" value="cartao" id="cartaoOption">
                    <label class="form-check-label" for="cartaoOption">Cartão de Crédito</label>
                </div>
            </div>

            <div id="cardFields" style="display: none;">
                <div class="mb-3">
                    <label for="cardName" class="form-label">Nome Completo</label>
                    <input type="text" class="form-control" id="cardName" name="cardName">
                </div>
                <div class="mb-3">
                    <label for="cardNumber" class="form-label">Número do Cartão</label>
                    <input type="text" class="form-control" id="cardNumber" name="cardNumber" maxlength="16">
                </div>
                <div class="mb-3">
                    <label for="cardCvv" class="form-label">Código Verificador (CVV)</label>
                    <input type="text" class="form-control" id="cardCvv" name="cardCvv" maxlength="4">
                </div>
                <div class="mb-3">
                    <label for="cardExpiry" class="form-label">Validade (MM/AA)</label>
                    <input type="text" class="form-control" id="cardExpiry" name="cardExpiry" placeholder="MM/AA">
                </div>
                <div class="mb-3">
                    <label for="installments" class="form-label">Parcelas</label>
                    <select class="form-select" id="installments" name="installments">
                        <option value="">Selecione</option>
                        <option value="1">1x</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="4">4x</option>
                        <option value="5">5x</option>
                        <option value="6">6x</option>
                        <option value="7">7x</option>
                        <option value="8">8x</option>
                        <option value="9">9x</option>
                        <option value="10">10x</option>
                        <option value="11">11x</option>
                        <option value="12">12x</option>
                    </select>
                </div>
            </div>

            <div class="text-end">
                <button type="submit" class="btn btn-success">Finalizar Pedido</button>
            </div>
        </form>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<script>
    const boletoRadio = document.getElementById('boletoOption');
    const cartaoRadio = document.getElementById('cartaoOption');
    const cardFields = document.getElementById('cardFields');
    const form = document.getElementById('paymentForm');

    function toggleCardFields() {
        cardFields.style.display = cartaoRadio.checked ? 'block' : 'none';
    }

    boletoRadio.addEventListener('change', toggleCardFields);
    cartaoRadio.addEventListener('change', toggleCardFields);

    form.addEventListener('submit', function (event) {
        const isCard = cartaoRadio.checked;
        if (isCard) {
            const requiredFields = ['cardName', 'cardNumber', 'cardCvv', 'cardExpiry', 'installments'];
            const allFilled = requiredFields.every(id => document.getElementById(id).value.trim() !== '');
            if (!allFilled) {
                event.preventDefault();
                alert('Preencha todos os campos do cartão para continuar.');
            }
        }
    });
</script>

</body>
</html>
