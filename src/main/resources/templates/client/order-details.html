<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Detalhes do Pedido</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/client/checkout-confirm.css}">
    <style>
        .total-geral strong { font-size: 1.25rem; }
        .table th, .table td { vertical-align: middle; }
    </style>
</head>
<body>

<div th:replace="~{fragments/header :: header}"></div>

<main class="container mt-5 mb-5">
    <div class="card shadow p-4 rounded-4">
        <h2 class="mb-4 text-center fw-bold text-primary">
            Detalhes do Pedido #<span th:text="${orderDetail.orderNumber}"></span>
        </h2>

        <div th:if="${error}" class="alert alert-danger" role="alert" th:text="${error}"></div>
        <div th:if="${message}" class="alert alert-success" role="alert" th:text="${message}"></div>

        <div class="row mb-3">
            <div class="col-md-6">
                <h5 class="fw-semibold">Status do Pedido</h5>
                <p><span th:text="${orderDetail.status}">Aguardando Pagamento</span></p>
            </div>
            <div class="col-md-6 text-md-end">
                <h5 class="fw-semibold">Data do Pedido</h5>
                <p th:if="${orderDetail.createdAt}" th:text="${#temporals.format(orderDetail.createdAt, 'dd/MM/yyyy HH:mm')}">01/01/2024 10:00</p>
                <p th:unless="${orderDetail.createdAt}">Data não registrada.</p>
            </div>
        </div>
        <hr>
        <div class="mb-3">
            <h5 class="fw-semibold">Endereço de Entrega</h5>
            <p th:if="${orderDetail.fullAddress}">
                <span th:text="${orderDetail.fullAddress}">Rua Exemplo, 123 - Apto 101</span><br>
                CEP: <span th:text="${orderDetail.cep}">00000-000</span>
            </p>
            <p th:unless="${orderDetail.fullAddress}">Endereço não informado.</p>
        </div>
        <hr>
        <div class="mb-3">
            <h5 class="fw-semibold">Itens do Pedido</h5>
            <table class="table table-hover">
                <thead class="table-light">
                <tr>
                    <th>Produto</th>
                    <th class="text-center">Qtd</th>
                    <th class="text-end">Preço Unit. (na compra)</th>
                    <th class="text-end">Subtotal</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${orderDetail.items}">
                    <td>
                        <a th:if="${item.productId}" th:href="@{/products/{id}(id=${item.productId})}" th:text="${item.productName}">Nome do Produto</a>
                        <span th:unless="${item.productId}" th:text="${item.productName}"></span>
                    </td>
                    <td class="text-center" th:text="${item.quantity}">1</td>
                    <td class="text-end" th:text="${'R$ ' + #numbers.formatDecimal(item.unitPrice, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</td>
                    <td class="text-end" th:text="${'R$ ' + #numbers.formatDecimal(item.subtotal, 1, 'POINT', 2, 'COMMA')}">R$ 0,00</td>
                </tr>
                <tr th:if="${#lists.isEmpty(orderDetail.items)}">
                    <td colspan="4" class="text-center fst-italic text-muted">Nenhum item encontrado neste pedido.</td>
                </tr>
                </tbody>
            </table>
        </div>
        <hr>
        <div class="row mb-3">
            <div class="col-md-6 ms-md-auto text-end">
                <p><strong>Subtotal Produtos:</strong> R$
                    <span th:text="${#numbers.formatDecimal(orderDetail.subtotalProdutos, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                </p>
                <p><strong>Frete:</strong> R$
                    <span th:text="${#numbers.formatDecimal(orderDetail.shippingCost, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                </p>
                <hr style="margin-top: 0.5rem; margin-bottom: 0.5rem;">
                <h5 class="total-geral"><strong>Total Geral do Pedido:</strong> R$
                    <span th:text="${#numbers.formatDecimal(orderDetail.grandTotal, 1, 'POINT', 2, 'COMMA')}">0,00</span>
                </h5>
            </div>
        </div>
        <hr>
        <div class="mb-4">
            <h5 class="fw-semibold">Forma de Pagamento</h5>
            <p th:text="${orderDetail.paymentMethodName ?: 'Não informada'}"></p>
        </div>

        <div class="text-center mt-4">
            <a th:href="@{/client/my-orders}" class="btn btn-outline-secondary btn-lg">Voltar para Meus Pedidos</a>
        </div>
    </div>
</main>

<div th:replace="~{fragments/footer :: footer}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
